<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Stats</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        function addPlayer() {
            const playerInput = document.getElementById('new_player');
            const playersArea = document.getElementById('players_area');
            const player = playerInput.value.trim();
            
            if (player) {
                if (playersArea.value) {
                    playersArea.value += '\n' + player;
                } else {
                    playersArea.value = player;
                }
                playerInput.value = '';
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
        const table = document.querySelector(".table-container table");
        const rows = Array.from(table.querySelectorAll("tbody tr"));

        // Iterate over each row (excluding the header row)
        rows.forEach(row => {
            const cells = Array.from(row.querySelectorAll(".stat"));
            const values = cells.map(cell => parseFloat(cell.textContent));

            // Find the min and max values in the row
            const minValue = Math.min(...values);
            const maxValue = Math.max(...values);

            // Apply colors to each cell in the row
            cells.forEach((cell, index) => {
            const value = values[index];

            if (cell.classList.contains("positive")) {
                // Positive metrics: green for max, red for min
                if (value === maxValue) {
                cell.classList.add("green");
                } else if (value === minValue) {
                cell.classList.add("red");
                }
            } else if (cell.classList.contains("negative")) {
                // Negative metrics: green for min, red for max
                if (value === minValue) {
                cell.classList.add("green");
                } else if (value === maxValue) {
                cell.classList.add("red");
                }
            }
            });
        });
        });
    </script>
</head>

<body>
    <h1>Titled Tuesday Statistics</h1>

    <!-- Mode Selection Form -->
    <form method="POST">
        <label for="mode">Choose an Option:</label>
        <select id="mode" name="mode" onchange="this.form.submit()">
            <option value="" disabled selected>Select...</option>
            <option value="tournament" {% if mode=='tournament' %}selected{% endif %}>Tournaments</option>
            <option value="player" {% if mode=='player' %}selected{% endif %}>Player</option>
            <option value="comparison" {% if mode=='comparison' %}selected{% endif %}>Compare Players</option>

        </select>
        <br>
        {% if mode != "comparison" %}
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" value="{{ start_date }}">
        <br>
        <label for="stop_date">Stop Date:</label>
        <input type="date" id="stop_date" name="stop_date" value="{{ stop_date }}">
        <br>
        {% endif %}
        {% if mode == "player" %}
        <label for="player_name">Enter Player Name:</label>
        <input type="text" id="player_name" name="player_name" value="{{ player_name }}" autofocus requireds>
        {% endif %}
        {% if mode != "comparison" %}
        <button type="submit">Show Stats</button>
        {% endif %}
    </form>

    {% if mode == 'comparison' %}
    <form method="POST">
        <input type="hidden" name="mode" value="comparison">
        <div class="player-input-container">
            <input type="text" id="new_player" placeholder="Enter player name" autofocus>
            <button type="button" onclick="addPlayer()">Add Player</button>
        </div>
        <textarea id="players_area" name="players" rows="5" cols="30" placeholder="Added players will appear here" required>{{ players | join('\n') }}</textarea><br>
        <label for="start_date">Start Date:</label>
        <input type="date" name="start_date" value="{{ start_date }}"><br>
        <label for="stop_date">End Date:</label>
        <input type="date" name="stop_date" value="{{ stop_date }}"><br>
        <button type="submit">Compare Players</button>
    </form>
    <div class="table-container">
        <table>
            <tr>
                <th>Statistic</th>
                {% for player_name in players %}
                <th>{{ player_name }}</th>
                {% endfor %}
            </tr>
            <tr>
                <td>Number of Tournaments</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.tournaments_count }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>First Tournament</td>
                {% for stats in stats_list %}
                <td>{{ stats.first_tournament }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Last Tournament</td>
                {% for stats in stats_list %}
                <td>{{ stats.last_tournament }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Total Possible Games</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.max_possible_games }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Games Played</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.real_number_of_games }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Skipped Games</td>
                {% for stats in stats_list %}
                <td class="stat negative">{{ stats.skipped_games }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Wins</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.wins }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Draws</td>
                {% for stats in stats_list %}
                <td>{{ stats.draws }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Losses</td>
                {% for stats in stats_list %}
                <td class="stat negative">{{ stats.losses }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Win Percentage</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.percent_of_wins|round(2) }}%</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Draw Percentage</td>
                {% for stats in stats_list %}
                <td>{{ stats.percent_of_draws|round(2) }}%</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Loss Percentage</td>
                {% for stats in stats_list %}
                <td class="stat negative">{{ stats.percent_of_losses|round(2) }}%</td>
                {% endfor %}
            </tr>
            <tr>
                <td>First Place Finishes</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.first_place }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Second Place Finishes</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.second_place }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Third Place Finishes</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.third_place }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Top 5 Finishes</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.top5 }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Top 10 Finishes</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.top10 }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Top 100 Finishes</td>
                {% for stats in stats_list %}
                <td class="stat positive">{{ stats.top100 }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Mean Place</td>
                {% for stats in stats_list %}
                <td class="stat negative">{{ stats.mean_place|round(2) }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Median Place</td>
                {% for stats in stats_list %}
                <td class="stat negative">{{ stats.median_place }}</td>
                {% endfor %}
            </tr>
        </table>
    </div>
    {% endif %}

    <!-- Tournament Statistics -->
    {% if mode == "tournament" %}
        <h2>Tournament Statistics</h2>
        <img src="{{ url_for('static', filename='pictures/num_of_players.png') }}" alt="Number of Players">
        <img src="{{ url_for('static', filename='pictures/winner_score.png') }}" alt="Winner Score">
        <img src="{{ url_for('static', filename='pictures/top_10_score.png') }}" alt="Top 10 Score">
        <img src="{{ url_for('static', filename='pictures/top_10_rating.png') }}" alt="Top 10 Rating">
        <img src="{{ url_for('static', filename='pictures/skips_per_round.png') }}" alt="Skips Per Round">
        <img src="{{ url_for('static', filename='pictures/winners_by_starting_rank.png') }}" alt="Winners by Starting Rank (bar)">
        <img src="{{ url_for('static', filename='pictures/winners_by_rating.png') }}" alt="Winners by Starting Rank (hist)">
        <img src="{{ url_for('static', filename='pictures/top_3_finishers.png') }}" alt="Top 3 Finishers">
        <!-- Top Participators -->
        <h2>Top Participators</h2>
        <div class="table-container">
            <table>
                <tr><th>Rank</th><th>Player</th><th>Participations</th></tr>
                {% for name, count in top_participators.items() %}
                <tr><td>{{ loop.index }}</td><td>{{ name }}</td><td>{{ count }}</td></tr>
                {% endfor %}
            </table>
        </div>
    {% endif %}

    <!-- Player Statistics -->
    {% if mode == "player" and stats %}
        <h2>Performance Summary for {{ player_name }}</h2>

        <div class="table-container">
            <table>
                <tr><th>Statistic</th><th>{{ player_name }}</th></tr>
                <tr><td>Number of Tournaments</td><td>{{ stats.tournaments_count }}</td></tr>
                <tr><td>First Tournament</td><td>{{ stats.first_tournament }}</td></tr>
                <tr><td>Last Tournament</td><td>{{ stats.last_tournament }}</td></tr>
                <tr><td>Total Possible Games</td><td>{{ stats.max_possible_games }}</td></tr>
                <tr><td>Games Played</td><td>{{ stats.real_number_of_games }}</td></tr>
                <tr><td>Skipped Games</td><td>{{ stats.skipped_games }}</td></tr>
                <tr><td>Wins</td><td>{{ stats.wins }}</td></tr>
                <tr><td>Draws</td><td>{{ stats.draws }}</td></tr>
                <tr><td>Losses</td><td>{{ stats.losses }}</td></tr>
                <tr><td>Win Percentage</td><td>{{ stats.percent_of_wins|round(2) }}%</td></tr>
                <tr><td>Draw Percentage</td><td>{{ stats.percent_of_draws|round(2) }}%</td></tr>
                <tr><td>Loss Percentage</td><td>{{ stats.percent_of_losses|round(2) }}%</td></tr>
                <tr><td>First Place Finishes</td><td>{{ stats.first_place }}</td></tr>
                <tr><td>Second Place Finishes</td><td>{{ stats.second_place }}</td></tr>
                <tr><td>Third Place Finishes</td><td>{{ stats.third_place }}</td></tr>
                <tr><td>Top 5 Finishes</td><td>{{ stats.top5 }}</td></tr>
                <tr><td>Top 10 Finishes</td><td>{{ stats.top10 }}</td></tr>
                <tr><td>Top 100 Finishes</td><td>{{ stats.top100 }}</td></tr>
                <tr><td>Mean Place</td><td>{{ stats.mean_place|round(2) }}</td></tr>
                <tr><td>Median Place</td><td>{{ stats.median_place }}</td></tr>
            </table>
        </div>

        <img src="{{ url_for('static', filename='pictures/' + player_name.replace(' ', '_') + '_ranking.png') }}"
         alt="Player Ranking" width="1200" height="900">
    {% endif %}

</body>
</html>
